{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/lib/stripe.ts"],"sourcesContent":["import Stripe from 'stripe';\r\n\r\nif (!process.env.STRIPE_SECRET_KEY) {\r\n  throw new Error('STRIPE_SECRET_KEY is missing. Please set it in your .env file.');\r\n}\r\n\r\nexport const stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {\r\n  apiVersion: '2024-12-18.acacia',\r\n  typescript: true,\r\n});\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAClC,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,SAAS,IAAI,iKAAM,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;IAC9D,YAAY;IACZ,YAAY;AACd"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst prismaClientSingleton = () => {\r\n  return new PrismaClient()\r\n}\r\n\r\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClientSingleton | undefined\r\n}\r\n\r\nconst prisma = globalForPrisma.prisma ?? prismaClientSingleton()\r\n\r\nexport default prisma\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,wBAAwB;IAC5B,OAAO,IAAI,6IAAY;AACzB;AAIA,MAAM,kBAAkB;AAIxB,MAAM,SAAS,gBAAgB,MAAM,IAAI;uCAE1B;AAEf,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/app/success/page.tsx"],"sourcesContent":["import { redirect } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport { CheckCircle, AlertCircle, Calendar, Clock, CreditCard } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport { stripe } from '@/lib/stripe';\r\nimport prisma from '@/lib/prisma';\r\n\r\ninterface SuccessPageProps {\r\n  searchParams: Promise<{\r\n    session_id?: string;\r\n  }>;\r\n}\r\n\r\nexport default async function SuccessPage({ searchParams }: SuccessPageProps) {\r\n  const { session_id } = await searchParams;\r\n\r\n  if (!session_id) {\r\n    return (\r\n      <ErrorState \r\n        title=\"Invalid Request\" \r\n        message=\"No payment session found. Please return home and try again.\" \r\n      />\r\n    );\r\n  }\r\n\r\n  try {\r\n    // 1. Retrieve Stripe Session\r\n    const session = await stripe.checkout.sessions.retrieve(session_id);\r\n    \r\n    // 2. Validate Payment Status\r\n    if (session.payment_status !== 'paid') {\r\n      return (\r\n        <ErrorState \r\n          title=\"Payment Incomplete\" \r\n          message=\"It looks like the payment hasn't been completed yet.\" \r\n        />\r\n      );\r\n    }\r\n\r\n    const bookingId = session.metadata?.bookingId;\r\n\r\n    if (!bookingId) {\r\n       return (\r\n        <ErrorState \r\n          title=\"Booking Not Found\" \r\n          message=\"We received your payment but couldn't find the associated booking details. Please contact support.\" \r\n        />\r\n      );\r\n    }\r\n\r\n    // 3. Fetch Booking from Prisma\r\n    // We update the status to PAID here just to be safe, though Webhook is the primary source of truth.\r\n    // In a real high-scale app, you might rely solely on the webhook, but for this UX, updating here ensures instant feedback.\r\n    const booking = await prisma.booking.update({\r\n      where: { id: bookingId },\r\n      data: { status: 'PAID' },\r\n    });\r\n\r\n    return (\r\n      <main className=\"min-h-screen bg-stone-50 flex items-center justify-center p-4\">\r\n        <div className=\"max-w-md w-full bg-white rounded-lg shadow-sm border border-stone-200 overflow-hidden\">\r\n          \r\n          {/* Header Section */}\r\n          <div className=\"p-8 text-center border-b border-stone-100\">\r\n            <div className=\"flex justify-center mb-4\">\r\n              <CheckCircle className=\"w-16 h-16 text-emerald-700\" strokeWidth={1.5} />\r\n            </div>\r\n            <h1 className=\"text-2xl font-serif font-medium text-stone-900 mb-2\">\r\n              Reservation Confirmed\r\n            </h1>\r\n            <p className=\"text-stone-500 text-sm\">\r\n              We have sent a confirmation email to <span className=\"font-semibold text-stone-700\">{session.customer_details?.email || booking.userEmail}</span>.\r\n            </p>\r\n          </div>\r\n\r\n          {/* Details Section */}\r\n          <div className=\"p-8 space-y-6\">\r\n            <div className=\"bg-stone-100 rounded-lg p-6 space-y-4\">\r\n              \r\n              {/* Date */}\r\n              <div className=\"flex items-center gap-3 text-stone-700\">\r\n                <Calendar className=\"w-5 h-5 text-stone-500\" />\r\n                <div>\r\n                  <p className=\"text-xs text-stone-500 uppercase tracking-wide font-semibold\">Date</p>\r\n                  <p className=\"font-medium\">\r\n                    {format(booking.startTime, 'EEEE, d MMM yyyy')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Time */}\r\n              <div className=\"flex items-center gap-3 text-stone-700\">\r\n                <Clock className=\"w-5 h-5 text-stone-500\" />\r\n                <div>\r\n                  <p className=\"text-xs text-stone-500 uppercase tracking-wide font-semibold\">Time</p>\r\n                  <p className=\"font-medium\">\r\n                    {format(booking.startTime, 'HH:mm')} - {format(booking.endTime, 'HH:mm')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Total Paid */}\r\n              <div className=\"flex items-center gap-3 text-stone-700 pt-2 border-t border-stone-200\">\r\n                <CreditCard className=\"w-5 h-5 text-stone-500\" />\r\n                <div>\r\n                  <p className=\"text-xs text-stone-500 uppercase tracking-wide font-semibold\">Total Paid</p>\r\n                  <p className=\"font-medium text-stone-900\">\r\n                    {(booking.totalPrice / 100).toFixed(2)}â‚¬\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n\r\n            {/* Actions */}\r\n            <Link \r\n              href=\"/\"\r\n              className=\"block w-full bg-stone-800 hover:bg-stone-700 text-white text-center font-bold py-3 rounded-lg transition-colors shadow-sm\"\r\n            >\r\n              Return to Home\r\n            </Link>\r\n          </div>\r\n          \r\n        </div>\r\n      </main>\r\n    );\r\n\r\n  } catch (error) {\r\n    console.error('Success Page Error:', error);\r\n    return (\r\n      <ErrorState \r\n        title=\"Something went wrong\" \r\n        message=\"We couldn't verify your booking details. If you were charged, please contact support.\" \r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nfunction ErrorState({ title, message }: { title: string, message: string }) {\r\n  return (\r\n    <main className=\"min-h-screen bg-stone-50 flex items-center justify-center p-4\">\r\n      <div className=\"max-w-md w-full bg-white rounded-lg shadow-sm border border-stone-200 p-8 text-center\">\r\n        <div className=\"flex justify-center mb-4\">\r\n          <AlertCircle className=\"w-12 h-12 text-stone-400\" />\r\n        </div>\r\n        <h1 className=\"text-xl font-bold text-stone-800 mb-2\">{title}</h1>\r\n        <p className=\"text-stone-500 mb-6\">{message}</p>\r\n        <Link \r\n          href=\"/\"\r\n          className=\"inline-block px-6 py-2 bg-stone-200 hover:bg-stone-300 text-stone-800 font-semibold rounded-md transition-colors\"\r\n        >\r\n          Return Home\r\n        </Link>\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}