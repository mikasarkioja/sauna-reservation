{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/app/actions/create-booking.ts"],"sourcesContent":["'use server';\n\nimport prisma from '../../lib/prisma';\nimport { stripe } from '../../lib/stripe';\nimport { calculateSaunaPrice, PricingError } from '../../lib/pricing';\nimport { BookingStatus } from '@prisma/client';\n\n/**\n * Interface for the booking request payload\n */\ninterface CreateBookingRequest {\n  userEmail: string;\n  userName?: string;\n  startTime: string; // ISO string\n  endTime: string;   // ISO string\n}\n\n/**\n * Interface for the server action response\n */\ninterface CreateBookingResponse {\n  success: boolean;\n  url?: string;\n  error?: string;\n}\n\n/**\n * Server Action to create a sauna booking.\n * \n * Flow:\n * 1. Validate inputs and calculate price.\n * 2. Check for availability (concurrency handling).\n * 3. Create PENDING booking in DB.\n * 4. Create Stripe Checkout Session.\n * 5. Update booking with Stripe Session ID.\n * 6. Return Stripe URL.\n */\nexport async function createBooking(data: CreateBookingRequest): Promise<CreateBookingResponse> {\n  try {\n    const start = new Date(data.startTime);\n    const end = new Date(data.endTime);\n    const { userEmail, userName } = data;\n\n    // 1. Basic Validation\n    if (!userEmail) {\n      throw new Error('User email is required.');\n    }\n    \n    // Validate dates and calculate price\n    // This throws PricingError if invalid\n    const priceInCents = calculateSaunaPrice(start, end);\n\n    // 2. Availability Check & Reservation (Concurrency Handling)\n    // \n    // CONCURRENCY EXPLANATION:\n    // The \"Check-Then-Act\" race condition occurs when two requests check for availability \n    // at the same time, both see the slot as free, and both insert a booking.\n    //\n    // To solve this in a robust production environment, we have a few options:\n    // A) Postgres Exclusion Constraints: Add a constraint to the DB to physically prevent overlapping time ranges (best).\n    // B) Serializable Transactions: Run the transaction with 'Serializable' isolation level.\n    // C) Table Locking: Lock the table (bad for performance).\n    //\n    // Here, we use a Prisma transaction to group the check and the insert. \n    // Ideally, we would use `isolationLevel: 'Serializable'`, but that requires retry logic as serialization failures are expected.\n    // For this scaffold, we perform a check for overlapping bookings within the transaction. \n    // Note: Without Serializable isolation or Exclusion constraints, a race condition is still theoretically possible \n    // if the DB isolation level is Read Committed (default).\n    \n    const booking = await prisma.$transaction(async (tx) => {\n      // Check for overlapping bookings that are NOT failed/cancelled\n      // Overlap logic: (StartA < EndB) and (EndA > StartB)\n      const existingBooking = await tx.booking.findFirst({\n        where: {\n          AND: [\n            { startTime: { lt: end } },\n            { endTime: { gt: start } },\n            {\n              status: {\n                in: [BookingStatus.PENDING, BookingStatus.PAID],\n              },\n            },\n          ],\n        },\n      });\n\n      if (existingBooking) {\n        throw new Error('The selected time slot is already booked.');\n      }\n\n      // Create PENDING booking\n      return tx.booking.create({\n        data: {\n          userEmail,\n          userName,\n          startTime: start,\n          endTime: end,\n          totalPrice: priceInCents,\n          status: BookingStatus.PENDING,\n        },\n      });\n    });\n\n    // 3. Create Stripe Checkout Session\n    // We do this AFTER creating the booking record so we have the ID.\n    // If Stripe fails, the PENDING booking will eventually need to be cleaned up (e.g. cron job or webhook expiry).\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price_data: {\n            currency: 'eur',\n            product_data: {\n              name: 'Sauna Reservation',\n              description: `${start.toLocaleString()} - ${end.toLocaleString()}`,\n            },\n            unit_amount: priceInCents,\n          },\n          quantity: 1,\n        },\n      ],\n      mode: 'payment',\n      success_url: `${process.env.NEXT_PUBLIC_APP_URL}/success?session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${process.env.NEXT_PUBLIC_APP_URL}/cancel`,\n      metadata: {\n        bookingId: booking.id, // Critical: Link Stripe session to our Booking\n      },\n      customer_email: userEmail,\n    });\n\n    if (!session.url) {\n      throw new Error('Failed to create Stripe session URL.');\n    }\n\n    // 4. Update booking with Stripe Session ID\n    // This allows us to look up the booking when the Stripe Webhook fires.\n    await prisma.booking.update({\n      where: { id: booking.id },\n      data: { stripeSessionId: session.id },\n    });\n\n    return { success: true, url: session.url };\n\n  } catch (error) {\n    console.error('Create Booking Error:', error);\n    \n    // Distinguish expected validation errors from system errors\n    if (error instanceof PricingError) {\n       return { success: false, error: error.message };\n    }\n    \n    // Return a generic error for safety, or specific if it's an expected \"Slot taken\" error\n    const message = error instanceof Error ? error.message : 'An unexpected error occurred.';\n    return { success: false, error: message };\n  }\n}\n\n"],"names":[],"mappings":";;;;;;;IAqCsB,gBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA"}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/lib/pricing.ts"],"sourcesContent":["export const PRICING_PER_30_MINS_CENTS = 1000; // 10.00€\r\nexport const MIN_DURATION_MINUTES = 60;\r\n\r\nexport class PricingError extends Error {\r\n  constructor(message: string) {\r\n    super(message);\r\n    this.name = 'PricingError';\r\n  }\r\n}\r\n\r\n/**\r\n * Calculates the sauna reservation price based on start and end time.\r\n * \r\n * Rules:\r\n * - Minimum reservation is 1 hour.\r\n * - Pricing is 10€ per 30-minute block.\r\n * - Duration must be a multiple of 30 minutes.\r\n * \r\n * @param start Start date of the reservation\r\n * @param end End date of the reservation\r\n * @returns Price in cents\r\n * @throws PricingError if validation fails\r\n */\r\nexport function calculateSaunaPrice(start: Date, end: Date): number {\r\n  const startTime = start.getTime();\r\n  const endTime = end.getTime();\r\n\r\n  if (endTime <= startTime) {\r\n    throw new PricingError('End time must be after start time.');\r\n  }\r\n\r\n  const durationMs = endTime - startTime;\r\n  const durationMinutes = durationMs / (1000 * 60);\r\n\r\n  // 1. Validate minimum duration\r\n  if (durationMinutes < MIN_DURATION_MINUTES) {\r\n    throw new PricingError(`Minimum reservation time is ${MIN_DURATION_MINUTES / 60} hour(s).`);\r\n  }\r\n\r\n  // 2. Validate 30-minute blocks\r\n  if (durationMinutes % 30 !== 0) {\r\n    throw new PricingError('Reservation duration must be in 30-minute increments.');\r\n  }\r\n\r\n  // 3. Calculate price\r\n  const blocks = durationMinutes / 30;\r\n  const priceCents = blocks * PRICING_PER_30_MINS_CENTS;\r\n\r\n  return priceCents;\r\n}\r\n\r\n\r\n"],"names":[],"mappings":";;;;;;;;;;AAAO,MAAM,4BAA4B,MAAM,SAAS;AACjD,MAAM,uBAAuB;AAE7B,MAAM,qBAAqB;IAChC,YAAY,OAAe,CAAE;QAC3B,KAAK,CAAC;QACN,IAAI,CAAC,IAAI,GAAG;IACd;AACF;AAeO,SAAS,oBAAoB,KAAW,EAAE,GAAS;IACxD,MAAM,YAAY,MAAM,OAAO;IAC/B,MAAM,UAAU,IAAI,OAAO;IAE3B,IAAI,WAAW,WAAW;QACxB,MAAM,IAAI,aAAa;IACzB;IAEA,MAAM,aAAa,UAAU;IAC7B,MAAM,kBAAkB,aAAa,CAAC,OAAO,EAAE;IAE/C,+BAA+B;IAC/B,IAAI,kBAAkB,sBAAsB;QAC1C,MAAM,IAAI,aAAa,CAAC,4BAA4B,EAAE,uBAAuB,GAAG,SAAS,CAAC;IAC5F;IAEA,+BAA+B;IAC/B,IAAI,kBAAkB,OAAO,GAAG;QAC9B,MAAM,IAAI,aAAa;IACzB;IAEA,qBAAqB;IACrB,MAAM,SAAS,kBAAkB;IACjC,MAAM,aAAa,SAAS;IAE5B,OAAO;AACT"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MikaS%C3%A4rkioja/Documents/Ty%C3%B6kansio/Cursor/SaunaReservation/src/components/booking/BookingForm.tsx"],"sourcesContent":["'use client';\n\n// Fix: Import 'createBooking' but rename it to 'createSaunaCheckout' \n// so the rest of your component works without changes.\nimport { createBooking as createSaunaCheckout } from '@/app/actions/create-booking';\nimport * as React from 'react';\nimport { format, addMinutes, isSameDay, startOfToday, parse } from 'date-fns';\nimport { DayPicker } from 'react-day-picker';\nimport { clsx } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\nimport { Calendar as CalendarIcon, Clock, CheckCircle, AlertCircle } from 'lucide-react';\nimport 'react-day-picker/dist/style.css';\nimport { PRICING_PER_30_MINS_CENTS, MIN_DURATION_MINUTES } from '@/lib/pricing';\n\n// --- Types ---\ninterface BookingFormProps {\n  // We can pass pre-fetched blocked dates/slots here in the future\n  blockedDates?: Date[]; \n}\n\n// Dummy data for booked slots to demonstrate logic\n// In a real app, this would be fetched based on the selected date\nconst DUMMY_BOOKED_SLOTS = [\n  '14:00', '14:30', '15:00' // Someone booked 14:00 - 15:30\n];\n\n// Configuration\nconst OPENING_HOUR = 10;\nconst CLOSING_HOUR = 22;\n\n/**\n * BookingForm Component\n * \n * Handles the full reservation flow:\n * 1. Date Selection\n * 2. Start Time Selection\n * 3. Duration Selection\n * 4. Cost Calculation & Summary\n */\nexport default function BookingForm({ blockedDates = [] }: BookingFormProps) {\n  // --- State ---\n  const [selectedDate, setSelectedDate] = React.useState<Date | undefined>(undefined);\n  const [startTime, setStartTime] = React.useState<string | null>(null);\n  const [durationMinutes, setDurationMinutes] = React.useState<number>(MIN_DURATION_MINUTES); // Default 1 hour\n  const [isSubmitting, setIsSubmitting] = React.useState(false);\n\n  // --- Derived State & Helpers ---\n\n  // Generate available start times for the selected date\n  const timeSlots = React.useMemo(() => {\n    if (!selectedDate) return [];\n\n    const slots: string[] = [];\n    const today = startOfToday();\n    const isToday = isSameDay(selectedDate, today);\n    const now = new Date();\n    \n    // Iterate from OPENING_HOUR to CLOSING_HOUR - (MIN_DURATION)\n    // We stop early because the last booking must be at least MIN_DURATION long.\n    // E.g. Closing 22:00, Min 1h -> Last start time 21:00.\n    const lastStartHour = CLOSING_HOUR - (MIN_DURATION_MINUTES / 60);\n\n    for (let hour = OPENING_HOUR; hour <= lastStartHour; hour++) {\n      for (let minute = 0; minute < 60; minute += 30) {\n        // Skip if this slot would start after the cut-off\n        if (hour === lastStartHour && minute > 0) continue;\n\n        const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;\n        \n        // Filter out past times if date is today\n        if (isToday) {\n          const slotDate = parse(timeString, 'HH:mm', selectedDate);\n          if (slotDate < now) continue;\n        }\n\n        // Filter out booked slots (Dummy Logic)\n        if (DUMMY_BOOKED_SLOTS.includes(timeString)) continue;\n\n        slots.push(timeString);\n      }\n    }\n    return slots;\n  }, [selectedDate]);\n\n  // Generate duration options based on selected start time\n  const durationOptions = React.useMemo(() => {\n    if (!startTime || !selectedDate) return [];\n\n    const [startHour, startMinute] = startTime.split(':').map(Number);\n    const startTotalMinutes = startHour * 60 + startMinute;\n    const closingTotalMinutes = CLOSING_HOUR * 60;\n    \n    const maxDurationMinutes = closingTotalMinutes - startTotalMinutes;\n    \n    const options = [];\n    // Increment by 30 mins, starting from MIN_DURATION\n    for (let d = MIN_DURATION_MINUTES; d <= maxDurationMinutes; d += 30) {\n      // Check if this duration overlaps with any booked slots (Simplified check)\n      // In a real app, you'd check if the range [startTime, startTime + d] overlaps with existing bookings\n      \n      const priceEur = (d / 30) * (PRICING_PER_30_MINS_CENTS / 100);\n      const hours = Math.floor(d / 60);\n      const mins = d % 60;\n      const label = `${hours > 0 ? `${hours}h` : ''} ${mins > 0 ? `${mins}m` : ''}`.trim();\n\n      options.push({\n        value: d,\n        label: `${label} (${priceEur.toFixed(2)}€)`,\n        price: priceEur\n      });\n    }\n    return options;\n  }, [startTime, selectedDate]);\n\n  // Calculate Total Price\n  const totalPrice = React.useMemo(() => {\n    return (durationMinutes / 30) * (PRICING_PER_30_MINS_CENTS / 100);\n  }, [durationMinutes]);\n\n  // --- Handlers ---\n\n  const handleDateSelect = (date: Date | undefined) => {\n    setSelectedDate(date);\n    setStartTime(null); // Reset time when date changes\n    setDurationMinutes(MIN_DURATION_MINUTES);\n  };\n\n  const handleTimeSelect = (time: string) => {\n    setStartTime(time);\n    setDurationMinutes(MIN_DURATION_MINUTES); // Reset duration to min\n  };\n\n  const handleSubmit = async () => {\n    if (!selectedDate || !startTime) return;\n\n    setIsSubmitting(true);\n\n    try {\n      // 1. Calculate the start and end Date objects\n      // \"startTime\" is a string like \"14:30\", we need to combine it with \"selectedDate\"\n      const startDateTime = parse(startTime, 'HH:mm', selectedDate);\n      const endDateTime = addMinutes(startDateTime, durationMinutes);\n\n      // 2. Call the Server Action (This runs on the server, creates DB record, and talks to Stripe)\n      // We assume you have a hardcoded user email for now, or you can add an input field for it\n      const result = await createSaunaCheckout({\n        startTime: startDateTime.toISOString(),\n        endTime: endDateTime.toISOString(),\n        userEmail: \"test-user@example.com\"\n      });\n\n      // 3. If we get a URL back, that means Stripe is ready. Go there!\n      if (result?.url) {\n        window.location.href = result.url;\n      } else {\n        alert(\"Something went wrong. No payment URL returned.\");\n      }\n\n    } catch (error) {\n      console.error(error);\n      alert(\"Failed to create reservation. Please try again.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // --- Render ---\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-4 md:p-6 bg-white rounded-xl shadow-sm border border-stone-200\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n        \n        {/* LEFT COLUMN: Calendar */}\n        <div className=\"flex flex-col\">\n          <h2 className=\"text-xl font-bold text-stone-800 mb-4 flex items-center gap-2\">\n            <CalendarIcon className=\"w-5 h-5 text-stone-600\" />\n            Select Date\n          </h2>\n          <div className=\"bg-stone-50/50 p-4 rounded-lg flex justify-center border border-stone-200\">\n            <DayPicker\n              mode=\"single\"\n              selected={selectedDate}\n              onSelect={handleDateSelect}\n              disabled={[{ before: new Date() }, ...blockedDates]}\n              modifiersClassNames={{\n                selected: 'bg-stone-800 text-white hover:bg-stone-900',\n                today: 'font-bold text-amber-700'\n              }}\n              className=\"p-0\"\n              classNames={{\n                day_selected: \"bg-stone-800 text-white hover:bg-stone-800 hover:text-white focus:bg-stone-800 focus:text-white rounded-md\",\n                day_today: \"text-amber-700 font-bold\",\n                day: \"h-9 w-9 p-0 font-normal aria-selected:opacity-100 hover:bg-stone-100 rounded-md transition-colors\",\n                head_cell: \"text-stone-500 rounded-md w-9 font-normal text-[0.8rem]\",\n              }}\n            />\n          </div>\n          <p className=\"text-sm text-stone-500 mt-4 text-center\">\n            {selectedDate \n              ? `Selected: ${format(selectedDate, 'EEEE, MMMM do, yyyy')}`\n              : 'Please pick a date to see available times.'}\n          </p>\n        </div>\n\n        {/* RIGHT COLUMN: Time & Duration */}\n        <div className=\"flex flex-col\">\n          <h2 className=\"text-xl font-bold text-stone-800 mb-4 flex items-center gap-2\">\n            <Clock className=\"w-5 h-5 text-stone-600\" />\n            Select Time\n          </h2>\n\n          {!selectedDate ? (\n            <div className=\"flex-1 flex flex-col items-center justify-center text-stone-400 bg-stone-50 rounded-lg border border-dashed border-stone-200 min-h-[300px]\">\n              <CalendarIcon className=\"w-12 h-12 mb-2 opacity-20\" />\n              <p>Choose a date first</p>\n            </div>\n          ) : (\n            <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n              \n              {/* Time Slots Grid */}\n              <div>\n                <label className=\"block text-sm font-medium text-stone-700 mb-2\">\n                  Start Time\n                </label>\n                {timeSlots.length === 0 ? (\n                  <div className=\"text-center p-4 bg-amber-50 text-amber-800 rounded-md border border-amber-100 flex items-center justify-center gap-2\">\n                    <AlertCircle className=\"w-4 h-4\" />\n                    No slots available for this date.\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-3 sm:grid-cols-4 gap-2 max-h-[200px] overflow-y-auto pr-2 custom-scrollbar\">\n                    {timeSlots.map((time) => (\n                      <button\n                        key={time}\n                        onClick={() => handleTimeSelect(time)}\n                        className={clsx(\n                          \"py-2 px-1 text-sm rounded-md border transition-all duration-200\",\n                          startTime === time\n                            ? \"bg-stone-800 text-white border-stone-800 shadow-sm transform scale-105\"\n                            : \"bg-white text-stone-600 border-stone-200 hover:border-stone-400 hover:bg-stone-50\"\n                        )}\n                      >\n                        {time}\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Duration Selection (Only visible if Start Time selected) */}\n              {startTime && (\n                <div className=\"animate-in fade-in slide-in-from-top-2 duration-300\">\n                  <label className=\"block text-sm font-medium text-stone-700 mb-2\">\n                    Duration\n                  </label>\n                  <select\n                    value={durationMinutes}\n                    onChange={(e) => setDurationMinutes(Number(e.target.value))}\n                    className=\"w-full p-2.5 bg-white border border-stone-300 rounded-md shadow-sm focus:ring-2 focus:ring-stone-500 focus:border-stone-500 outline-none text-stone-700\"\n                  >\n                    {durationOptions.map((option) => (\n                      <option key={option.value} value={option.value}>\n                        {option.label}\n                      </option>\n                    ))}\n                  </select>\n                  <p className=\"text-xs text-stone-500 mt-1\">\n                    Price: 10€ / 30 mins\n                  </p>\n                </div>\n              )}\n\n            </div>\n          )}\n\n          {/* Spacer to push summary to bottom */}\n          <div className=\"flex-grow\" />\n\n          {/* Summary Card */}\n          {startTime && selectedDate && (\n            <div className=\"mt-8 bg-stone-100 text-stone-800 p-6 rounded-xl border border-stone-200 animate-in fade-in slide-in-from-bottom-4\">\n              <h3 className=\"text-lg font-semibold mb-4 border-b border-stone-200 pb-2 text-stone-900\">\n                Reservation Summary\n              </h3>\n              \n              <div className=\"space-y-2 text-sm text-stone-600 mb-6\">\n                <div className=\"flex justify-between\">\n                  <span>Date:</span>\n                  <span className=\"font-medium text-stone-900\">{format(selectedDate, 'MMM do, yyyy')}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Time:</span>\n                  <span className=\"font-medium text-stone-900\">{startTime} - {format(addMinutes(parse(startTime, 'HH:mm', selectedDate), durationMinutes), 'HH:mm')}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span>Duration:</span>\n                  <span className=\"font-medium text-stone-900\">{durationMinutes / 60} hours</span>\n                </div>\n              </div>\n\n              <div className=\"flex items-end justify-between mb-6 border-t border-stone-200 pt-4\">\n                <span className=\"text-stone-500\">Total Price</span>\n                <span className=\"text-3xl font-bold text-stone-800\">{totalPrice.toFixed(2)}€</span>\n              </div>\n\n              <button\n                onClick={handleSubmit}\n                disabled={isSubmitting}\n                className=\"w-full bg-stone-800 hover:bg-stone-900 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-not-allowed shadow-sm\"\n              >\n                {isSubmitting ? 'Processing...' : (\n                  <>\n                    Reserve Now\n                    <CheckCircle className=\"w-5 h-5\" />\n                  </>\n                )}\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}